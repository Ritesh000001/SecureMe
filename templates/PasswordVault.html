{% extends "Nav.html" %}
{% block title %}Password Vault{% endblock %}
{% block content %}

<style>
    body {
        background: #fff;
        color: #111;
        font-family: "Poppins", sans-serif;
    }

    .vault-container {
        max-width: 1100px;
        margin: 40px auto;
        padding: 20px;
    }

    .vault-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .vault-header h2 {
        font-weight: 600;
        color: #111;
    }

    .filter-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        align-items: center;
    }

    .filter-bar select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
    }

    .add-btn {
        background: #111;
        color: #fff;
        border: none;
        padding: 8px 18px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: 0.2s;
    }

    .add-btn:hover {
        background: #333;
    }

    .vault-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .vault-card {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 18px;
        transition: 0.3s;
        cursor: pointer;
        position: relative;
    }

    .vault-card:hover {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .vault-card h4 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #111;
    }

    .vault-card p {
        margin: 5px 0;
        font-size: 14px;
        color: #333;
    }

    .category-tag {
        display: inline-block;
        padding: 3px 8px;
        background: #e0e0e0;
        border-radius: 6px;
        font-size: 12px;
        color: #444;
        margin-bottom: 10px;
    }

    .eye-icon {
        cursor: pointer;
        margin-left: 6px;
    }

    /* Edit mode styling */
    .vault-card form {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .vault-card input,
    .vault-card select {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
    }

    .save-btn {
        background: #111;
        color: #fff;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        align-self: flex-end;
        transition: 0.2s;
    }

    .save-btn:hover {
        background: #333;
    }

    .no-data {
        text-align: center;
        color: #666;
        margin-top: 30px;
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal-content {
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        width: 350px;
        position: relative;
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .modal-content h3 {
        margin-bottom: 15px;
        font-size: 20px;
    }

    .modal-content input,
    .modal-content select {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-bottom: 10px;
        font-size: 14px;
    }

    .modal-actions {
        display: flex;
        justify-content: space-between;
    }

    .cancel-btn {
        background: #999;
        color: #fff;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
    }
</style>

<div class="vault-container">

    <div class="vault-header">
        <h2>üîê My Password Vault</h2>
        <button class="add-btn" id="addBtn">+ Add Password</button>
    </div>

    <div class="filter-bar">
        <label for="filter">Filter by Category:</label>
        <select id="filter">
            <option value="All">All</option>
            <option value="Social">Social</option>
            <option value="Work">Work</option>
            <option value="Finance">Finance</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Other">Other</option>
        </select>
    </div>

    {% if vault_entries and vault_entries|length > 0 %}
    <div class="vault-grid" id="vaultGrid">
        {% for entry in vault_entries %}
        <div class="vault-card" data-category="{{ entry.category }}" data-id="{{ loop.index }}">
            <span class="category-tag">{{ entry.category }}</span>
            <h4>{{ entry.name }}</h4>
            <p><strong>Website:</strong> <a href="{{ entry.website }}" target="_blank">{{ entry.website }}</a></p>
            <p><strong>Email/User:</strong> {{ entry.contact }}</p>
            <p><strong>Password:</strong>
                <span class="password-value" data-password="{{ entry.password }}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                <span class="eye-icon" onclick="togglePassword(this)">üëÅÔ∏è</span>
            </p>
            <p><small>Added: {{ entry.date }}</small></p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="no-data">No passwords saved yet. Click ‚ÄúAdd Password‚Äù to create one.</p>
    {% endif %}
</div>

<div id="addModal" class="modal">
    <div class="modal-content">
        <h3>Add New Password</h3>
        <form method="POST" action="/vault/add">
            <input type="text" name="website" placeholder="Website URL" required>
            <input type="text" name="name" placeholder="Name" required>
            <input type="text" name="contact" placeholder="Email / Username / Phone">
            <input type="password" name="password" placeholder="Password" required>
            <select name="category" required>
                <option value="Social">Social</option>
                <option value="Work">Work</option>
                <option value="Finance">Finance</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Other" selected>Other</option>
            </select>
            <div class="modal-actions">
                <button type="submit" class="save-btn">üíæ Save</button>
                <button type="button" id="closeModal" class="cancel-btn">‚úñ Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    const filter = document.getElementById("filter");
    const vaultGrid = document.getElementById("vaultGrid");
    let activeEditCard = null;

    filter.addEventListener("change", () => {
        const category = filter.value;
        document.querySelectorAll(".vault-card").forEach(card => {
            card.style.display = (category === "All" || card.dataset.category === category) ? "block" : "none";
        });
    });

    function togglePassword(el) {
        const pwSpan = el.previousElementSibling;
        const realPw = pwSpan.getAttribute("data-password");
        if (pwSpan.textContent === "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢") {
            pwSpan.textContent = realPw;
            el.textContent = "üôà";
        } else {
            pwSpan.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
            el.textContent = "üëÅÔ∏è";
        }
    }

    function restoreCard(card, originalHTML) {
        card.innerHTML = originalHTML;
        activeEditCard = null;
    }

    document.querySelectorAll(".vault-card").forEach(card => {
        card.addEventListener("click", function (e) {
            if (e.target.classList.contains("eye-icon")) return;
            if (activeEditCard && activeEditCard !== this) return;

            activeEditCard = this;
            const originalHTML = this.innerHTML;
            const id = this.dataset.id;
            const name = this.querySelector("h4").textContent;
            const website = this.querySelector("a").textContent;
            const contact = this.querySelector("p:nth-of-type(2)").textContent.replace("Email/User:", "").trim();
            const category = this.dataset.category;
            const password = this.querySelector(".password-value").getAttribute("data-password");

            this.innerHTML = `
                <form method="POST" action="/password-vault/edit/${id}">
                    <input type="text" name="name" value="${name}" placeholder="Name" required>
                    <input type="text" name="website" value="${website}" placeholder="Website URL" required>
                    <input type="text" name="contact" value="${contact}" placeholder="Email / Username">
                    <input type="password" name="password" value="${password}" placeholder="Password" required>
                    <select name="category" required>
                        <option ${category === "Social" ? "selected" : ""}>Social</option>
                        <option ${category === "Work" ? "selected" : ""}>Work</option>
                        <option ${category === "Finance" ? "selected" : ""}>Finance</option>
                        <option ${category === "Entertainment" ? "selected" : ""}>Entertainment</option>
                        <option ${category === "Other" ? "selected" : ""}>Other</option>
                    </select>
                    <button type="submit" class="save-btn">üíæ Save</button>
                </form>
            `;

            function handleOutsideClick(event) {
                if (!card.contains(event.target)) {
                    restoreCard(card, originalHTML);
                    document.removeEventListener("click", handleOutsideClick);
                }
            }
            setTimeout(() => document.addEventListener("click", handleOutsideClick), 50);
        });
    });

    const addBtn = document.getElementById("addBtn");
    const addModal = document.getElementById("addModal");
    const closeModal = document.getElementById("closeModal");

    addBtn.addEventListener("click", () => addModal.style.display = "flex");
    closeModal.addEventListener("click", () => addModal.style.display = "none");
    window.addEventListener("click", (e) => { if (e.target === addModal) addModal.style.display = "none"; });
</script>

{% endblock %}