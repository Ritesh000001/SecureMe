{% extends "Nav.html" %}
{% block title %}Notes{% endblock %}
{% block content %}

<style>
    body {
        margin: 0;
        background-color: #fafafa;
        color: #1e1e1e;
        font-family: "Inter", "Segoe UI", sans-serif;
    }

    .notes-container {
        position: relative;
        display: flex;
        height: 90vh;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        margin: 2rem;
    }

    /* Sidebar */
    .sidebar {
        width: 280px;
        background-color: #fff;
        border-right: 1px solid #e0e0e0;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        z-index: 1;
    }

    .sidebar h3 {
        font-size: 1rem;
        color: #333;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-left: 4px;
    }

    .create-btn {
        display: block;
        background-color: #1e1e1e;
        color: white;
        text-align: center;
        font-weight: 600;
        padding: 10px;
        border-radius: 6px;
        text-decoration: none;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }

    .create-btn:hover {
        background-color: #444;
    }

    .note-item {
        padding: 10px 12px;
        border-radius: 6px;
        cursor: pointer;
        color: #333;
        text-decoration: none;
        display: block;
        font-size: 0.95rem;
        transition: all 0.2s ease;
    }

    .note-item:hover {
        background-color: #f5f5f5;
    }

    .note-item.active {
        background-color: #1e1e1e;
        color: #fff;
    }

    /* Editor Section */
    .editor-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #fff;
        padding: 2rem;
        overflow-y: auto;
        position: relative;
    }

    .editor-section form {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .title-input,
    .text-area {
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 12px;
        font-size: 1rem;
        transition: border-color 0.2s;
    }

    .title-input {
        margin-bottom: 1rem;
    }

    .title-input:focus,
    .text-area:focus {
        outline: none;
        border-color: #1e1e1e;
    }

    .text-area {
        flex: 1;
        resize: none;
    }

    .button-row {
        margin-top: 1rem;
        display: flex;
        gap: 10px;
    }

    .btn {
        background-color: #1e1e1e;
        border: none;
        padding: 10px 18px;
        color: #fff;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn:hover {
        background-color: #333;
    }

    .btn-secondary {
        background-color: #e0e0e0;
        color: #333;
    }

    .btn-secondary:hover {
        background-color: #d5d5d5;
    }

    .empty-message {
        text-align: center;
        color: #999;
        margin-top: 20%;
    }

    .key-panel {
        position: absolute;
        top: 0;
        right: 0;
        width: 765px;
        height: 100%;
        padding-top: 240px;
        background-color: #1e1e1e;
        color: #fff;
        box-shadow: -4px 0 12px rgba(0, 0, 0, 0.2);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        z-index: 3;
    }

    .key-panel.visible {
        transform: translateX(0);
    }


    .key-input {
        background-color: #fafafa;
        border: 1px solid #ccc;
        color: #333;
        padding: 10px;
        border-radius: 6px;
        font-size: 1rem;
        width: 250px;
        text-align: center;
    }

    .submit-btn {
        margin-top: 1rem;
        background-color: #fff;
        border: none;
        color: #1e1e1e;
        padding: 8px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    .submit-btn:hover {
        background-color: #f0f0f0;
    }
</style>

<div class="notes-container">
    <div class="sidebar">
        <a href="{{ url_for('create_new_note') }}" class="create-btn">Ôºã New Note</a>
        <h3>My Notes</h3>
        {% for note in notes %}
        <a class="note-item {% if note == active_note %}active{% endif %}"
            href="{{ url_for('open_note', filename=note) }}">{{ note }}</a>
        {% else %}
        <p style="color:#999; font-size:0.9rem;">No notes yet</p>
        {% endfor %}
    </div>

    <div class="editor-section">
        {% if new %}
        <form method="POST" action="{{ url_for('create_new_note') }}">
            <input type="text" name="title" placeholder="Enter new file name..." class="title-input" required />
            <textarea name="content" placeholder="Write your content..." class="text-area" required></textarea>
            <div class="button-row">
                <button type="submit" class="btn">üíæ Save Note</button>
            </div>
        </form>

        {% elif active_note %}
        <form method="POST" action="{{ url_for('edit_note', filename=active_note) }}">
            <input type="hidden" name="current_key" value="{{ current_key }}" />
            <input type="text" name="title" value="{{ title }}" class="title-input" id="titleInput" readonly />
            <textarea name="content" class="text-area" id="contentArea" readonly>{{ content }}</textarea>
            <div class="button-row">
                <button type="button" id="editBtn" class="btn">‚úèÔ∏è Edit</button>
                <button type="submit" id="saveBtn" class="btn" style="display:none;">üíæ Save Note</button>
            </div>
        </form>

        <script>
            const editBtn = document.getElementById("editBtn");
            const saveBtn = document.getElementById("saveBtn");
            const titleInput = document.getElementById("titleInput");
            const contentArea = document.getElementById("contentArea");

            editBtn.addEventListener("click", () => {
                titleInput.removeAttribute("readonly");
                contentArea.removeAttribute("readonly");
                contentArea.focus();
                editBtn.style.display = "none";
                saveBtn.style.display = "inline-block";
            });
        </script>

        {% else %}
        <div class="empty-message">
            <h3>Select a note from the left to view or create a new one</h3>
        </div>
        {% endif %}

        {% if active_note %}
        <div class="key-panel {% if show_key_prompt %}visible{% endif %}">
            <h2>üîë Enter Encryption Key</h2>
            <form method="POST" action="{{ url_for('open_note', filename=active_note) }}">
                <input type="password" name="key" maxlength="6" class="key-input" placeholder="Enter 6-character key"
                    required />
                <button type="submit" class="submit-btn">Unlock</button>
            </form>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}